{% extends "data_collection/templates/base.html" %}
{% load static %}
{% block content %}

<h2>Farmer Dashboard</h2>
<div id="map" style="height: 500px;"></div>

<!-- Leaflet JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var map = L.map('map').setView([23.6157, 81.9195], 6);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Fetch data from Django API
    fetch("{% url 'dashboard_data' %}")
    .then(response => response.json())
    .then(data => {
        // Add farmer locations (Points)
        data.farmers.forEach(farmer => {
            var marker = L.marker(farmer.geometry.coordinates.reverse()).addTo(map);
            marker.bindPopup(`
                <b>Name:</b> ${farmer.properties.name}<br>
                <b>Village:</b> ${farmer.properties.village}<br>
                <b>Mobile:</b> ${farmer.properties.mobile}
            `);
        });

        // Add farm boundaries (Polygons)
        data.farms.forEach(farm => {
            var polygon = L.polygon(farm.geometry.coordinates, {color: 'blue', fillOpacity: 0.3}).addTo(map);
            polygon.bindPopup(`
                <b>Farm:</b> ${farm.properties.farm_name}<br>
                <b>Area:</b> ${farm.properties.area} acres<br>
                <b>Owner:</b> ${farm.properties.owner}
            `);
        });

        // Add plantation boundaries (Polygons)
        data.plantations.forEach(plantation => {
            var polygon = L.polygon(plantation.geometry.coordinates, {color: 'green', fillOpacity: 0.3}).addTo(map);
            polygon.bindPopup(`
                <b>Kyari:</b> ${plantation.properties.kyari_name}<br>
                <b>Saplings:</b> ${plantation.properties.number_of_saplings}
            `);
        });
    })
    .catch(error => console.error("Error fetching data:", error));
});
</script>


{% endblock %}

